<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Retirement Spending Calculator üèñÔ∏è</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; }
        .container { max-width: 600px; background: #fff; margin: 40px auto; border-radius: 20px; box-shadow: 0 4px 24px #0001; padding: 28px; }
        h2 { text-align: center; }
        label { font-weight: 600; margin-bottom: 3px; display: block; }
        input { padding: 8px 12px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #bbb; width: 100%; box-sizing: border-box; }
        .row { margin-bottom: 18px; }
        button { background: #2563eb; color: #fff; padding: 12px 0; width: 100%; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; margin-top: 8px; }
        button:hover { background: #1d4ed8; }
        .table-area { margin-top: 28px; background: #fff; padding: 12px; border-radius: 14px; box-shadow: 0 2px 8px #0002; overflow-x: auto;}
        table { border-collapse: collapse; width: 100%; }
        th, td { padding: 10px 8px; border-bottom: 1px solid #eee; text-align: right; }
        th { background: #f1f5f9; color: #1e293b; font-size: 0.9em; }
        td:first-child, th:first-child { text-align: center; }
        .summary { margin-top: 25px; padding: 18px; background: #e0f2fe; border: 1px solid #7dd3fc; border-radius: 14px; font-size: 1.1em; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h2>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì üèñÔ∏è</h2>
        <div class="row">
            <label for="principal">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (‡∏ö‡∏≤‡∏ó)</label>
            <input type="text" id="principal" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 10,000,000" oninput="formatNumberInput(this)" />
        </div>
        <div class="row">
            <label for="retirementYears">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (‡∏õ‡∏µ)</label>
            <input type="text" id="retirementYears" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 25" oninput="formatNumberInput(this, false)" />
        </div>
        <div class="row">
            <label for="returnRate">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ï‡πà‡∏≠‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (%)</label>
            <input type="text" id="returnRate" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 5" oninput="formatNumberInput(this, false)" />
        </div>
        <div class="row">
            <label for="inflation">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏õ‡∏µ (%)</label>
            <input type="text" id="inflation" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 3" oninput="formatNumberInput(this, false)" />
        </div>
        <button onclick="calcAndShowTable()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
        
        <div id="summary" class="summary" style="display:none;"></div>
        <div id="table-area" class="table-area" style="display:none;"></div>
    </div>

    <script>
        function formatNumberInput(el, allowDecimal = true) {
            let v = el.value.replace(/,/g, "");
            if (!allowDecimal) v = v.replace(/\D/g, '');
            else v = v.replace(/[^0-9.]/g, '');

            const parts = v.split(".");
            if (parts.length > 2) v = parts[0] + '.' + parts.slice(1).join('');

            let [intPart, decPart] = v.split(".");
            intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            el.value = decPart !== undefined ? intPart + "." + decPart : intPart;
        }

        function getInputNumber(id) {
            const val = document.getElementById(id).value.replace(/,/g, "");
            return Number(val) || 0;
        }

        function calcAndShowTable() {
            const principal = getInputNumber('principal');
            const n = getInputNumber('retirementYears'); // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì
            const r = getInputNumber('returnRate') / 100; // ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô
            const g = getInputNumber('inflation') / 100; // ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠

            if (!principal || !n) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏µ‡πÅ‡∏£‡∏Å (C) ‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£ Present Value of Growing Annuity
            // PV = C / (r - g) * (1 - ((1+g)/(1+r))^n)
            // C = PV * (r - g) / (1 - ((1+g)/(1+r))^n)
            let firstYearExpense;
            if (Math.abs(r - g) < 1e-9) { // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà r ‡πÅ‡∏•‡∏∞ g ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
                firstYearExpense = principal * (1 + r) / n;
            } else {
                firstYearExpense = principal * (r - g) / (1 - Math.pow((1 + g) / (1 + r), n));
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ
            const summaryEl = document.getElementById('summary');
            summaryEl.innerHTML = `
                ‡∏õ‡∏µ‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏î‡πâ <b>${firstYearExpense.toLocaleString(undefined, {maximumFractionDigits: 0})}</b> ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ<br>
                (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ <b>${(firstYearExpense / 12).toLocaleString(undefined, {maximumFractionDigits: 0})}</b> ‡∏ö‡∏≤‡∏ó)
            `;
            summaryEl.style.display = 'block';

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà</th>
                            <th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°<br>(‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)</th>
                            <th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢<br>(‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</th>
                            <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏•‡∏≤‡∏¢‡∏õ‡∏µ<br>(‡∏ö‡∏≤‡∏ó)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            let remainingBalance = principal;
            for (let i = 1; i <= n; i++) {
                // ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏õ‡∏µ‡∏ô‡∏±‡πâ‡∏ô‡πÜ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠)
                let currentYearWithdrawal = firstYearExpense * Math.pow(1 + g, i - 1);
                let monthlyExpense = currentYearWithdrawal / 12;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏õ‡∏µ * (1 + ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô) - ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏≠‡∏ô‡πÉ‡∏ä‡πâ
                remainingBalance = remainingBalance * (1 + r) - currentYearWithdrawal;

                // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÉ‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà 0)
                const displayBalance = Math.max(0, remainingBalance);

                tableHTML += `
                    <tr>
                        <td>${i}</td>
                        <td>${currentYearWithdrawal.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                        <td>${monthlyExpense.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                        <td style="font-weight:bold;">${displayBalance.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                    </tr>
                `;
                 if (remainingBalance <= 0) break;
            }

            tableHTML += `</tbody></table>`;
            const tableArea = document.getElementById('table-area');
            tableArea.innerHTML = tableHTML;
            tableArea.style.display = "block";
        }
    </script>
</body>
</html>
