<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retirement Calculator 🏖️</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; }
    .container { max-width: 500px; background: #fff; margin: 40px auto; border-radius: 20px; box-shadow: 0 4px 24px #0001; padding: 28px; }
    label { font-weight: 600; margin-bottom: 3px; display: block; }
    input, select { padding: 6px 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #bbb; width: 100%; }
    .row { margin-bottom: 18px; }
    button { background: #2563eb; color: #fff; padding: 10px 0; width: 100%; font-size: 1rem; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; margin-top: 8px; }
    button:hover { background: #1d4ed8; }
    .result { margin-top: 25px; padding: 18px; background: #d1fae5; border-radius: 14px; font-size: 1.2em; text-align: center; }
    .small { font-size: 0.9em; color: #666; }
    .table-area { margin-top: 28px; background: #fff; padding: 12px; border-radius: 14px; box-shadow: 0 2px 8px #0002; overflow-x: auto;}
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: 8px 8px; border-bottom: 1px solid #eee; text-align: right; }
    th { background: #f1f5f9; color: #1e293b; }
    td:first-child, th:first-child { text-align: center; }
    .close-btn { float: right; color: #555; cursor: pointer; font-weight: bold; margin-top: -8px;}
    .close-btn:hover { color: #dc2626;}
  </style>
</head>
<body>
  <div class="container">
    <h2>เครื่องมือคำนวณเงินเกษียณ 🏖️</h2>
    <div class="row">
      <label>เงินตั้งต้นตอนเกษียณ</label>
      <input type="text" id="initialFund" min="0" required placeholder="เช่น 5,000,000" oninput="formatNumberInput(this)" />
    </div>
    <div class="row">
      <label>ค่าใช้จ่ายปีแรกหลังเกษียณ (บาท/ปี)</label>
      <input type="text" id="firstYearExpense" min="0" required placeholder="เช่น 300,000" oninput="formatNumberInput(this)" />
    </div>
    <div class="row">
      <label>ระยะเวลาหลังเกษียณที่ต้องการ (ปี)</label>
      <input type="text" id="afterRetireYears" min="1" required placeholder="เช่น 25" oninput="formatNumberInput(this, false)" />
    </div>
    <div class="row">
      <label>อัตราผลตอบแทนต่อปีหลังเกษียณ (%)</label>
      <input type="text" id="returnRate" min="0" step="0.01" required placeholder="ฝากประจำ 1-3% , หุ้นกู้ 3-6%" oninput="formatNumberInput(this, false)" />
    </div>
    <div class="row">
      <label>อัตราเงินเฟ้อต่อปี (%)</label>
      <input type="text" id="inflation" min="0" step="0.01" required placeholder="เช่น 3" oninput="formatNumberInput(this, false)" />
    </div>
    <button onclick="calculateRetirementPlan()">คำนวณแผนเกษียณ</button>
    <div class="result" id="result"></div>
    <div class="table-area" id="table-area" style="display:none"></div>
  </div>
  <script>
    function formatNumberInput(el, allowDecimal = true) {
      let v = el.value.replace(/,/g, "");
      if (!allowDecimal) v = v.replace(/\D/g, '');
      else v = v.replace(/[^0-9.]/g, '');

      const parts = v.split(".");
      if (parts.length > 2) v = parts[0] + '.' + parts[1];

      let withComma = v;
      if (withComma) {
        let [intPart, decPart] = withComma.split(".");
        intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        withComma = decPart ? intPart + "." + decPart : intPart;
      }
      el.value = withComma;
    }

    function getInputNumber(id) {
      const val = document.getElementById(id).value.replace(/,/g, "");
      return Number(val);
    }

    function calculateRetirementPlan() {
      const initialFund = getInputNumber('initialFund');
      const firstYearExpense = getInputNumber('firstYearExpense');
      const afterRetireYears = getInputNumber('afterRetireYears');
      const returnRate = getInputNumber('returnRate') / 100;
      const inflation = getInputNumber('inflation') / 100;

      if (!initialFund || !firstYearExpense || !afterRetireYears) {
        document.getElementById('result').innerHTML = `<span style="color: #dc2626;">โปรดกรอกข้อมูลให้ครบถ้วน</span>`;
        document.getElementById('table-area').style.display = 'none';
        return;
      }

      let currentFund = initialFund;
      let annualExpense = firstYearExpense;
      let tableHTML = `
        <span class="close-btn" onclick="document.getElementById('table-area').style.display='none'">&times;</span>
        <b>ตารางแผนเกษียณ</b>
        <table>
          <thead>
            <tr>
              <th>ปีที่</th>
              <th>ค่าใช้จ่ายรวมต่อปี<br>(บาท)</th>
              <th>ค่าใช้จ่ายเฉลี่ยต่อเดือน<br>(บาท)</th>
              <th>เงินคงเหลือปลายปี<br>(บาท)</th>
            </tr>
          </thead>
          <tbody>
      `;

      let foundWarning = false;
      for (let i = 1; i <= afterRetireYears; i++) {
        // Add return to the fund
        currentFund = currentFund * (1 + returnRate);

        // Subtract expense
        currentFund = currentFund - annualExpense;

        const monthlyExpense = annualExpense / 12;

        tableHTML += `
          <tr>
            <td>${i}</td>
            <td>${annualExpense.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
            <td>${monthlyExpense.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
            <td>${currentFund > 0 ? currentFund.toLocaleString(undefined, {maximumFractionDigits: 0}) : '<span style="color: red;">หมด</span>'}</td>
          </tr>
        `;

        // If fund runs out, stop calculation and show warning
        if (currentFund <= 0 && !foundWarning) {
          document.getElementById('result').innerHTML = `
            <span style="color: #dc2626; font-weight: bold;">เงินทุนของคุณจะหมดลงในปีที่ ${i}</span>
          `;
          foundWarning = true;
          break;
        }

        // Increase expense for next year by inflation
        annualExpense = annualExpense * (1 + inflation);
      }

      tableHTML += `</tbody></table>`;
      document.getElementById('table-area').innerHTML = tableHTML;
      document.getElementById('table-area').style.display = "block";

      if (!foundWarning) {
        document.getElementById('result').innerHTML = `
          <b>เงินคงเหลือปลายปีสุดท้าย:</b><br>
          <span style="font-size:2em;color:#059669;">${currentFund.toLocaleString(undefined, {maximumFractionDigits: 0})} บาท</span>
        `;
      }
    }
  </script>
</body>
</html>
