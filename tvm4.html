<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retirement Spending üèñÔ∏è</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; }
    .container { max-width: 500px; background: #fff; margin: 40px auto; border-radius: 20px; box-shadow: 0 4px 24px #0001; padding: 28px; }
    label { font-weight: 600; margin-bottom: 3px; display: block; }
    input { padding: 6px 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #bbb; width: 100%; }
    .row { margin-bottom: 18px; }
    button { background: #2563eb; color: #fff; padding: 10px 0; width: 100%; font-size: 1rem; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; margin-top: 8px; }
    button:hover { background: #1d4ed8; }
    .table-area { margin-top: 28px; background: #fff; padding: 12px; border-radius: 14px; box-shadow: 0 2px 8px #0002; overflow-x: auto;}
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: 8px 8px; border-bottom: 1px solid #eee; text-align: right; }
    th { background: #f1f5f9; color: #1e293b; }
    td:first-child, th:first-child { text-align: center; }
    .close-btn { float: right; color: #555; cursor: pointer; font-weight: bold; margin-top: -8px;}
    .close-btn:hover { color: #dc2626;}
  </style>
</head>
<body>
  <div class="container">
    <h2>‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì üèñÔ∏è</h2>
    <div class="row">
      <label>‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (‡∏ö‡∏≤‡∏ó)</label>
      <input type="text" id="initialFund" oninput="formatNumberInput(this)" />
    </div>
    <div class="row">
      <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</label>
      <input type="text" id="afterRetire" oninput="formatNumberInput(this, false)" />
    </div>
    <div class="row">
      <label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏µ‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)</label>
      <input type="text" id="firstYearExpense" oninput="formatNumberInput(this)" />
    </div>
    <div class="row">
      <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ï‡πà‡∏≠‡∏õ‡∏µ (%)</label>
      <input type="text" id="returnRate" oninput="formatNumberInput(this, false)" />
    </div>
    <div class="row">
      <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏õ‡∏µ (%)</label>
      <input type="text" id="inflation" oninput="formatNumberInput(this, false)" />
    </div>
    <button onclick="generateSpendingTable()">‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô</button>
    <div class="table-area" id="table-area" style="display:none"></div>
  </div>

  <script>
    function formatNumberInput(el, allowDecimal = true) {
      let v = el.value.replace(/,/g, "");
      if (!allowDecimal) v = v.replace(/\D/g, '');
      else v = v.replace(/[^0-9.]/g, '');
      const parts = v.split(".");
      if (parts.length > 2) v = parts[0] + '.' + parts[1];
      let withComma = v;
      if (withComma) {
        let [intPart, decPart] = withComma.split(".");
        intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        withComma = decPart ? intPart + "." + decPart : intPart;
      }
      el.value = withComma;
    }

    function getInputNumber(id) {
      const val = document.getElementById(id).value.replace(/,/g, "");
      return Number(val);
    }

    function generateSpendingTable() {
      const fund = getInputNumber('initialFund');
      const years = getInputNumber('afterRetire');
      const firstExpense = getInputNumber('firstYearExpense');
      const r = getInputNumber('returnRate') / 100;
      const g = getInputNumber('inflation') / 100;

      if (!fund || !years || !firstExpense) return;

      let tableHTML = `
        <span class="close-btn" onclick="document.getElementById('table-area').style.display='none'">&times;</span>
        <b>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</b>
        <table>
          <thead>
            <tr>
              <th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà</th>
              <th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏µ</th>
              <th>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
              <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏•‡∏≤‡∏¢‡∏õ‡∏µ</th>
            </tr>
          </thead>
          <tbody>
      `;

      let remain = fund;
      for (let i = 1; i <= years; i++) {
        const yearlyExpense = firstExpense * Math.pow(1 + g, i - 1);
        const monthlyExpense = yearlyExpense / 12;
        remain = remain * (1 + r) - yearlyExpense;
        tableHTML += `
          <tr>
            <td>${i}</td>
            <td>${yearlyExpense.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>
            <td>${monthlyExpense.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>
            <td>${remain > 0 ? remain.toLocaleString(undefined, { maximumFractionDigits: 0 }) : "0"}</td>
          </tr>
        `;
        if (remain <= 0) break;
      }

      tableHTML += `</tbody></table>`;
      document.getElementById('table-area').innerHTML = tableHTML;
      document.getElementById('table-area').style.display = "block";
    }
  </script>
</body>
</html>
