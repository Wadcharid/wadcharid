<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Running Calculator — Single File (4 Pages)</title>
<style>
  :root{
    --bg:#f4f7fb; --card:#ffffff; --text:#233041; --muted:#6b7a90;
    --primary:#0d6efd; --primary-700:#0b5ed7; --ring:rgba(13,110,253,.25);
    --border:#e6eef8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;word-wrap:break-word;}
  header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(6px);
         border-bottom:1px solid var(--border);z-index:10}
  .wrap{max-width:1000px;margin:0 auto;padding:12px 16px}
  .brand{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .dot{height:36px;width:36px;border-radius:12px;background:var(--primary)}
  .subtitle{font-size:12px;color:#64748b;margin-top:2px}
  nav{border-top:1px solid var(--border)}
  .tabs{display:flex;gap:8px;overflow-x:auto;padding:8px 12px}
  .tab{flex-shrink:0;padding:8px 14px;border:1px solid var(--border);border-radius:999px;background:#fff;
       font-size:14px;cursor:pointer;white-space:nowrap}
  .tab.active{background:var(--primary);color:#fff;border-color:var(--primary)}
  main{max-width:1000px;margin:0 auto;padding:20px 8px}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;
        box-shadow:0 2px 8px rgba(15,23,42,.03);max-width:900px;margin:0 auto;overflow:hidden}
  .card-h{display:flex;gap:10px;align-items:center;padding:16px;border-bottom:1px solid var(--border);flex-wrap:wrap}
  .card-h .badge{height:28px;width:28px;border-radius:999px;background:var(--ring)}
  .card-b{padding:16px}

  /* ——— Layout เดียวกันทุกอุปกรณ์ ——— */
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:1fr;} /* คง one-column บนทุกจอเพื่อให้หน้าตาเหมือนกันเป๊ะ */

  label{font-size:13px;color:#334155;display:flex;flex-direction:column;gap:8px}
  input[type="number"], input[type="text"]{
    padding:12px;border:1px solid var(--border);border-radius:10px;outline:none;text-align:center;width:100%;
    font-size:16px; /* ป้องกัน iOS Zoom และให้ขนาดคงที่ทุกจอ */
  }
  input:focus{box-shadow:0 0 0 6px var(--ring)}

  .row{display:flex;gap:8px;align-items:stretch;flex-wrap:wrap}
  .row input{flex:1 1 auto;min-width:0}

  /* ปุ่มขนาดเท่ากันทุกที่ */
  .btn{
    padding:0 16px;border:none;border-radius:10px;background:var(--primary);color:#fff;cursor:pointer;
    font-weight:600;width:100%;height:44px;font-size:14px;
  }
  .btn:hover{background:var(--primary-700)}

  .section-title{margin:18px 0 8px;font-weight:700}
  .list{display:grid;gap:8px}
  .item{background:#fff;border:1px solid var(--border);border-left:4px solid var(--primary);border-radius:10px;padding:10px}

  /* ตารางเลื่อนแนวนอนได้ทุกหน้าจอ + หัวตาราง sticky เหมือนกัน */
  table{border-collapse:collapse;width:100%;display:block;overflow-x:auto;-webkit-overflow-scrolling:touch}
  th,td{border:1px solid var(--border);padding:8px;text-align:center;font-size:14px;white-space:nowrap}
  thead tr{background:#eef2ff;position:sticky;top:0}
  tfoot tr{background:#e0f2fe;font-weight:700}

  .muted{color:var(--muted);font-size:12px}
  .hint{font-size:12px;color:#475569}
  .pill{display:inline-block;background:var(--primary);color:#fff;border-radius:999px;padding:3px 8px;font-size:11px}
  .note{background:#f8fafc;border:1px solid var(--border);border-radius:12px;padding:12px;overflow-x:auto}
  footer{padding:28px 12px;text-align:center;color:#94a3b8;font-size:12px}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <div style="font-weight:700">Running Calculator</div>
          <div class="subtitle">วิ่งให้สนุก สุขทุกก้าว</div>
        </div>
      </div>
    </div>
    <nav>
      <div class="wrap tabs">
        <button class="tab active" data-tab="time">Time/Pace/Distance</button>
        <button class="tab" data-tab="race">Race Predict</button>
        <button class="tab" data-tab="training">Training Pace</button>
        <button class="tab" data-tab="table">Pace Table</button>
      </div>
    </nav>
  </header>

  <main>
    <!-- PAGE: TIME/PACE/DISTANCE -->
    <section class="card page" id="page-time">
      <div class="card-h"><div class="badge"></div><h2>Time, Pace, Distance Calculator</h2></div>
      <div class="card-b">
        <div class="grid grid-2">
          <label>
            เวลา (ชั่วโมง:นาที:วินาที)
            <div class="row">
              <input id="t-h" type="number" placeholder="h">
              <input id="t-m" type="number" placeholder="m">
              <input id="t-s" type="number" placeholder="s">
            </div>
          </label>
          <button class="btn" onclick="calcTIME()">คำนวณ TIME</button>
        </div>

        <div class="grid grid-2" style="margin-top:12px">
          <label>
            Pace (นาที:วินาที ต่อกม.)
            <div class="row">
              <input id="p-m" type="number" placeholder="m">
              <input id="p-s" type="number" placeholder="s">
            </div>
          </label>
          <button class="btn" onclick="calcPACE()">คำนวณ PACE</button>
        </div>

        <div class="grid grid-2" style="margin-top:12px">
          <label>
            ระยะทาง (กม.)
            <input id="dist" type="number" step="0.01" placeholder="km">
          </label>
          <div class="row">
            <button class="btn" onclick="calcDIST()">คำนวณ DISTANCE</button>
            <button class="btn" onclick="calcPacePercents()">คำนวณ %PACE</button>
          </div>
        </div>

        <div id="pace-percent-box" class="note" style="margin-top:12px; display:none">
          <div class="section-title">% Pace</div>
          <div id="pace-percent-list" class="list"></div>
        </div>
        <div class="muted" style="margin-top:8px">ขอให้สนุกกับการวิ่งครับ!</div>
      </div>
    </section>

    <!-- PAGE: RACE PREDICT -->
    <section class="card page" id="page-race" style="display:none">
      <div class="card-h"><div class="badge"></div><h2>Race Predict (Reverse LT Pace)</h2></div>
      <div class="card-b">
        <div class="grid grid-2">
          <label>ผลที่ทำได้ (ระยะทาง กม.)<input id="rp-ach-d" type="number" step="any" placeholder="เช่น 5 - 42.195"></label>
          <div class="row">
            <input id="rp-h" type="number" placeholder="ชั่วโมง">
            <input id="rp-m" type="number" placeholder="นาที">
            <input id="rp-s" type="number" placeholder="วินาที">
          </div>
          <label>ระยะทางคาดการณ์ (กม.)<input id="rp-forecast-d" type="number" step="any" placeholder="เช่น 21.1"></label>
          <button class="btn" onclick="racePredict()">คำนวณ</button>
        </div>

        <div id="rp-result" style="margin-top:14px; display:none" class="note"></div>

        <div class="section-title">ผลลัพธ์สำหรับระยะมาตรฐาน</div>
        <div id="rp-standards" class="list"></div>

        <div class="section-title">% ของ Pace จาก LT Pace</div>
        <div id="rp-pct-lt" class="list grid-2"></div>

        <div class="section-title">% ของ Pace จาก Pace อินพุต</div>
        <div id="rp-pct-input" class="list grid-2"></div>

        <div class="section-title">แนวทางเวลาการฝึกตาม %LT Pace</div>
        <div class="note" style="overflow:auto">
          <table class=""
            ><thead><tr>
              <th>%LT</th><th>เหมาะสำหรับ</th><th>เวลาที่มีประสิทธิภาพ</th><th>ไม่ควรเกิน</th><th>จำนวนเที่ยว (Intervals)</th>
            </tr></thead>
            <tbody>
              <tr><td>60–70%</td><td>AR / CD</td><td>30–90 นาที</td><td>≤100 นาที</td><td>–</td></tr>
              <tr><td>70–80%</td><td>AB</td><td>60–120 นาที</td><td>≤180 นาที</td><td>–</td></tr>
              <tr><td>80–85%</td><td>AT</td><td>45–90 นาที</td><td>≤120 นาที</td><td>–</td></tr>
              <tr><td>85–90%</td><td>MP</td><td>40–70 นาที</td><td>≤80 นาที</td><td>–</td></tr>
              <tr><td>90–95%</td><td>MP / Tempo</td><td>30–50 นาที</td><td>≤60 นาที</td><td>–</td></tr>
              <tr><td>95–105%</td><td>TH / Intervals</td><td>20–35 นาที</td><td>≤45 นาที</td><td>3–5 เที่ยว (6–10 นาที)</td></tr>
              <tr><td>105–115%</td><td>VO2 Max</td><td>–</td><td>≤25 นาที</td><td>4–6 เที่ยว (600–1000m)</td></tr>
              <tr><td>115–120%</td><td>Speed</td><td>–</td><td>≤15 นาที</td><td>6–8 เที่ยว (400m)</td></tr>
              <tr><td>125%</td><td>Sprint</td><td>–</td><td>≤4 นาที</td><td>6–12 เที่ยว (50–200m)</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- PAGE: TRAINING PACE -->
    <section class="card page" id="page-training" style="display:none">
      <div class="card-h"><div class="badge"></div><h2>Training Pace Calculator from LT Pace</h2></div>
      <div class="card-b">
        <div class="grid grid-2">
          <label>ผลที่ทำได้ (ระยะทาง กม.)<input id="tp-ach-d" type="number" step="any" placeholder="5–42.2"></label>
          <div class="row">
            <input id="tp-h" type="number" placeholder="ชั่วโมง">
            <input id="tp-m" type="number" placeholder="นาที">
            <input id="tp-s" type="number" placeholder="วินาที">
          </div>
          <button class="btn" onclick="trainingPace()">คำนวณ</button>
        </div>

        <div id="tp-head" class="note" style="margin-top:14px; display:none"></div>

        <div id="tp-blocks" class="list" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- PAGE: PACE TABLE -->
    <section class="card page" id="page-table" style="display:none">
      <div class="card-h"><div class="badge"></div><h2>Pace & Time Table Calculator</h2></div>
      <div class="card-b">
        <div style="overflow:auto">
          <table id="tbl">
            <thead>
              <tr>
                <th>Distance (km)</th>
                <th>Pace (Minutes)</th>
                <th>Pace (Seconds)</th>
                <th>Time (mm:ss)</th>
                <th>Accumulated Time</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <!-- rows injected -->
            </tbody>
            <tfoot>
              <tr>
                <td id="sum-dist">0.00</td>
                <td colspan="2" id="avg-pace">Average Pace: 0:00</td>
                <td id="sum-time">0:00:00</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
        <div style="margin-top:10px; display:flex; gap:8px">
          <button class="btn" onclick="addRow()">Add Row</button>
          <button class="btn" onclick="clearRows()">Clear</button>
        </div>
      </div>
    </section>
  </main>

  <footer>© <span id="yr"></span> Running Calculator · Single-file Edition</footer>

<script>
  // ---------- helpers ----------
  const $ = (s) => document.querySelector(s);
  const $$ = (s) => Array.from(document.querySelectorAll(s));
  const pad2 = (n) => n.toString().padStart(2, '0');

  function mmss(totalMinutes){
    const sec = Math.round(totalMinutes*60);
    const m = Math.floor(sec/60); const s = sec%60; return `${m}:${pad2(s)}`;
  }
  function formatTime(totalSeconds){
    totalSeconds = Math.round(totalSeconds);
    const h = Math.floor(totalSeconds/3600);
    const m = Math.floor((totalSeconds%3600)/60);
    const s = totalSeconds%60;
    return `${h>0? h+" ชั่วโมง ":""}${(m>0||h>0)? m+" นาที ":""}${s} วินาที`;
  }

  // ---------- Tabs ----------
  $$(".tab").forEach(btn=>btn.addEventListener('click', e=>{
    $$(".tab").forEach(b=>b.classList.remove('active'));
    e.currentTarget.classList.add('active');
    const key = e.currentTarget.dataset.tab;
    $$(".page").forEach(p=>p.style.display='none');
    $('#page-'+key).style.display = '';
  }));
  $('#yr').textContent = new Date().getFullYear();

  // ---------- Page 1: Time/Pace/Distance ----------
  function totalPaceSec(){ return (parseInt($('#p-m').value)||0)*60 + (parseInt($('#p-s').value)||0); }
  function totalTimeSec(){ return (parseInt($('#t-h').value)||0)*3600 + (parseInt($('#t-m').value)||0)*60 + (parseInt($('#t-s').value)||0); }

  function calcTIME(){
    const d = parseFloat($('#dist').value)||0; if(d<=0) return alert('กรุณากรอกระยะทางให้มากกว่า 0');
    const t = totalPaceSec()*d; const h=Math.floor(t/3600), m=Math.floor((t%3600)/60), s=Math.round(t%60);
    $('#t-h').value=h; $('#t-m').value=m; $('#t-s').value=s;
  }
  function calcPACE(){
    const d = parseFloat($('#dist').value)||0; if(d<=0) return alert('กรุณากรอกระยะทางให้มากกว่า 0');
    const t = totalTimeSec(); const p = t/d; const m=Math.floor(p/60), s=Math.round(p%60);
    $('#p-m').value=m; $('#p-s').value=s;
  }
  function calcDIST(){
    const t = totalTimeSec(); const p = totalPaceSec(); if(p<=0) return alert('กรุณากรอก Pace ให้ถูกต้องก่อน');
    const d = t/p; $('#dist').value = d.toFixed(2);
  }
  function calcPacePercents(){
    const p = totalPaceSec(); if(p<=0) return alert('กรุณากรอก Pace ให้ถูกต้องก่อน');
    const list = $('#pace-percent-list'); list.innerHTML='';
    const arr=[55,60,65,70,75,80,85,90,95,97,100,105,110,115,120,125];
    arr.forEach(percent=>{
      const newSec = p/(percent/100); const mm=Math.floor(newSec/60); const ss=pad2(Math.round(newSec%60));
      const div=document.createElement('div'); div.className='item';
      div.textContent = `${percent}% = ${mm}:${ss} นาที/กม.`;
      list.appendChild(div);
    });
    $('#pace-percent-box').style.display='block';
  }

  // ---------- Core model used by Race & Training ----------
  function computeRaceTime(targetDistance, ltTotalSec){
    const segments = [
      { duration: 2, percent: 120 },
      { duration: 6, percent: 110 },
      { duration: 30, percent: 100 },
      { duration: 120, percent: 90 },
      { duration: 120, percent: 80 },
      { duration: 120, percent: 65 },
    ];
    let totalTimeMinutes = 0; let remainingDistance = targetDistance;
    const adjustedPace = (percent) => (ltTotalSec * (100/percent))/60; // นาที/กม.
    for(const seg of segments){
      const pace = adjustedPace(seg.percent);
      const segDistance = seg.duration/pace;
      if(segDistance < remainingDistance){ totalTimeMinutes += seg.duration; remainingDistance -= segDistance; }
      else { totalTimeMinutes += remainingDistance*pace; remainingDistance = 0; break; }
    }
    if(remainingDistance>0){ const pace50 = adjustedPace(50); totalTimeMinutes += remainingDistance*pace50; }
    return totalTimeMinutes;
  }
  function findLTPace(achievedDistance, achievedTimeMinutes, high=600){
    let low=120, highBound=high, mid=300;
    for(let i=0;i<30;i++){
      mid=(low+highBound)/2;
      const computed = computeRaceTime(achievedDistance, mid);
      if(computed>achievedTimeMinutes) highBound=mid; else low=mid;
    }
    return mid; // วินาที/กม.
  }

  // ---------- Page 2: Race Predict ----------
  function racePredict(){
    const d = parseFloat($('#rp-ach-d').value); const fd = parseFloat($('#rp-forecast-d').value);
    const H=parseInt($('#rp-h').value)||0, M=parseInt($('#rp-m').value)||0, S=parseInt($('#rp-s').value)||0;
    if(!d||!fd) return alert('กรอกระยะทางทั้งสองช่อง');
    const totalAchMin = H*60 + M + S/60; const inputPace = totalAchMin/d;
    const ltTotalSec = findLTPace(d, totalAchMin);
    const ltPaceStr = mmss(ltTotalSec/60);
    const forecastMin = computeRaceTime(fd, ltTotalSec);
    const forecastSec = Math.round(forecastMin*60);

    const box=$('#rp-result');
    box.innerHTML = `<div><b>Pace จากผลที่ทำได้:</b> ${mmss(inputPace)} นาที/กม.</div>
                     <div><b>LT Pace ที่คำนวณได้:</b> ${ltPaceStr} นาที/กม.</div>
                     <div><b>เวลาคาดการณ์:</b> ${formatTime(forecastSec)} <span class="pill">Pace เฉลี่ย ${mmss(forecastMin/fd)} นาที/กม.</span></div>`;
    box.style.display='block';

    // standards
    const standards=[
      {label:'5K',distance:5},{label:'5M',distance:8.04672},{label:'10K',distance:10},{label:'10M',distance:16.09344},
      {label:'Half Marathon',distance:21.0975},{label:'33K',distance:33},{label:'Marathon',distance:42.195}
    ];
    const st=$('#rp-standards'); st.innerHTML='';
    standards.forEach(item=>{
      const tMin = computeRaceTime(item.distance, ltTotalSec);
      const li=document.createElement('div'); li.className='item';
      li.innerHTML = `<div style="font-weight:600">${item.label} (${item.distance} กม.)</div>
                      <div>${formatTime(Math.round(tMin*60))} <span class="pill" style="margin-left:6px">${mmss(tMin/item.distance)} นาที/กม.</span></div>`;
      st.appendChild(li);
    });

    // pct from LT
    const box1=$('#rp-pct-lt'); box1.innerHTML='';
    for(let p=60;p<=125;p+=5){
      const paceAtPercent = (ltTotalSec*(100/p))/60; const div=document.createElement('div'); div.className='item';
      div.textContent = `${p}% — ${mmss(paceAtPercent)} นาที/กม.`; box1.appendChild(div);
    }
    // pct from input pace
    const box2=$('#rp-pct-input'); box2.innerHTML='';
    for(let p=60;p<=125;p+=5){
      const paceAtPercent = inputPace*(100/p); const div=document.createElement('div'); div.className='item';
      div.textContent = `${p}% — ${mmss(paceAtPercent)} นาที/กม.`; box2.appendChild(div);
    }
  }

  // ---------- Page 3: Training Pace ----------
  function trainingPace(){
    const d=parseFloat($('#tp-ach-d').value); const H=parseInt($('#tp-h').value)||0; const M=parseInt($('#tp-m').value)||0; const S=parseInt($('#tp-s').value)||0;
    if(!d || (H+M+S===0)) return alert('กรอกระยะทางและเวลา');
    const totalMin = H*60 + M + S/60; const inputPace = totalMin/d; const ltTotalSec = findLTPace(d,totalMin,720);
    const ltStr = mmss(ltTotalSec/60);

    $('#tp-head').innerHTML = `<div><b>Pace จากผลการแข่งขัน:</b> ${mmss(inputPace)} นาที/กม.</div>
                               <div style="font-size:16px;font-weight:700">LT Pace: ${ltStr} นาที/กม.</div>`;
    $('#tp-head').style.display='block';

    const range=(low,high)=>{ const fast=(ltTotalSec*(100/high))/60; const slow=(ltTotalSec*(100/low))/60; return `${mmss(fast)} - ${mmss(slow)}` };
    const blocks=[
      {title:'Easy Run Pace วิ่งต่อเนื่อง', items:[
        {k:'60 นาที (80-85% LT)', v:range(80,85)},
        {k:'90 นาที (75-80% LT)', v:range(75,80)},
        {k:'120 นาที (70-75% LT)', v:range(70,75)},
        {k:'120 นาที B2B (65-70% LT)', v:range(65,70)},
      ]},
      {title:'Threshold Run Pace (Tempo) วิ่งต่อเนื่อง', items:[
        {k:'20 นาที (100-105% LT)', v:range(100,105)},
        {k:'30 นาที (95-100% LT)', v:range(95,100)},
        {k:'45 นาที (90-95% LT)', v:range(90,95)},
        {k:'60 นาที (85-90% LT)', v:range(85,90)},
      ]},
      {title:'Interval Run Pace ระยะเวลาวิ่งรวม 20-30 นาที', items:[
        {k:'วิ่ง 1 นาที จ๊อก 1 นาที (110-115% LT)', v:range(110,115)},
        {k:'วิ่ง 3 นาที พัก 1 นาที (105-110% LT)', v:range(105,110)},
        {k:'วิ่ง 5 นาที พัก 1 นาที (100-105% LT)', v:range(100,105)},
      ]},
    ];

    const blk=$('#tp-blocks'); blk.innerHTML='';
    blocks.forEach(b=>{
      const box=document.createElement('div'); box.className='item';
      box.innerHTML = `<div style="font-weight:700">${b.title}</div>`;
      const ul=document.createElement('div'); ul.style.marginTop='6px';
      b.items.forEach(it=>{
        const li=document.createElement('div'); li.style.display='flex'; li.style.justifyContent='space-between'; li.style.padding='6px 0'; li.style.borderTop='1px solid var(--border)';
        li.innerHTML = `<span class="hint">${it.k}</span><span style="font-weight:600">${it.v}</span>`;
        ul.appendChild(li);
      });
      box.appendChild(ul); blk.appendChild(box);
    });
  }

  // ---------- Page 4: Pace Table ----------
  const tbody = $('#tbody');
  function addRow(){
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td><input type="number" step="0.1" value="" oninput="updateRow(this)"></td>
      <td><input type="number" value="" oninput="updateRow(this)"></td>
      <td><input type="number" value="" oninput="updateRow(this)"></td>
      <td class="time">0:00</td>
      <td class="acc">0:00</td>`;
    tbody.appendChild(tr); recalc();
  }
  function clearRows(){ tbody.innerHTML=''; recalc(); }
  function updateRow(el){
    const tr=el.closest('tr');
    const d=parseFloat(tr.children[0].querySelector('input').value)||0;
    const pm=parseInt(tr.children[1].querySelector('input').value)||0;
    const ps=parseInt(tr.children[2].querySelector('input').value)||0;
    const paceSec = pm*60+ps; const totalSec = d*paceSec; const mm=Math.floor(totalSec/60), ss=Math.round(totalSec%60);
    tr.querySelector('.time').textContent = `${mm}:${pad2(ss)}`; recalc();
  }
  function recalc(){
    let totalD=0, totalSec=0; const times=[];
    Array.from(tbody.children).forEach(tr=>{
      const d=parseFloat(tr.children[0].querySelector('input').value)||0; totalD+=d;
      const txt=tr.querySelector('.time').textContent.split(':'); const t=(parseInt(txt[0])||0)*60 + (parseInt(txt[1])||0);
      totalSec += t; times.push(t);
    });
    // accumulated
    let acc=0; Array.from(tbody.children).forEach((tr,i)=>{ acc+=times[i]||0; const m=Math.floor(acc/60), s=acc%60; tr.querySelector('.acc').textContent=`${m}:${pad2(s)}`; });
    // summary
    const h=Math.floor(totalSec/3600), m=Math.floor((totalSec%3600)/60), s=totalSec%60;
    $('#sum-dist').textContent = totalD.toFixed(2);
    const avg = totalD>0? Math.ceil(totalSec/totalD):0; const apm=Math.floor(avg/60), aps=avg%60;
    $('#avg-pace').textContent = `Average Pace: ${apm}:${pad2(aps)}`;
    $('#sum-time').textContent = `${h}:${pad2(m)}:${pad2(s)}`;
  }
  // init 1 row
  addRow();
</script>
</body>
</html>
