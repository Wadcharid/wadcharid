<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retirement Calculator üèñÔ∏è</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; }
    .container { max-width: 500px; background: #fff; margin: 40px auto; border-radius: 20px; box-shadow: 0 4px 24px #0001; padding: 28px; }
    label { font-weight: 600; margin-bottom: 3px; display: block; }
    input, select { padding: 6px 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #bbb; width: 100%; }
    .row { margin-bottom: 18px; }
    button { background: #2563eb; color: #fff; padding: 10px 0; width: 100%; font-size: 1rem; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; margin-top: 8px; }
    button:hover { background: #1d4ed8; }
    .result { margin-top: 25px; padding: 18px; background: #d1fae5; border-radius: 14px; font-size: 1.2em; text-align: center; }
    .small { font-size: 0.9em; color: #666; }
    .table-area { margin-top: 28px; background: #fff; padding: 12px; border-radius: 14px; box-shadow: 0 2px 8px #0002; overflow-x: auto;}
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: 8px 8px; border-bottom: 1px solid #eee; text-align: right; }
    th { background: #f1f5f9; color: #1e293b; }
    td:first-child, th:first-child { text-align: center; }
    .close-btn { float: right; color: #555; cursor: pointer; font-weight: bold; margin-top: -8px;}
    .close-btn:hover { color: #dc2626;}
  </style>
</head>
<body>
  <div class="container">
    <h2>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì üèñÔ∏è</h2>
    <div class="row">
      <label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
      <input type="text" id="expense" min="0" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 30,000" oninput="formatNumberInput(this)" />
      <select id="expenseType">
        <option value="month">‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
        <option value="year">‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ</option>
      </select>
    </div>
    <div class="row">
      <label>‡∏≠‡∏µ‡∏Å‡∏Å‡∏µ‡πà‡∏õ‡∏µ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</label>
      <input type="text" id="untilRetire" min="0" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 15 (‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠ 1)" oninput="formatNumberInput(this, false)" />
    </div>
    <div class="row">
      <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏õ‡∏µ (%)</label>
      <input type="text" id="inflation" min="0" step="0.01" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 3" oninput="formatNumberInput(this, false)" />
    </div>
    <div class="row">
      <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ï‡πà‡∏≠‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (%)</label>
      <input type="text" id="returnRate" min="0" step="0.01" required placeholder="‡∏ù‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥ 1-3% , ‡∏´‡∏∏‡πâ‡∏ô‡∏Å‡∏π‡πâ 3-6%" oninput="formatNumberInput(this, false)" />
    </div>
    <div class="row">
      <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
      <input type="text" id="afterRetire" min="1" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 25" oninput="formatNumberInput(this, false)" />
      <select id="afterType">
        <option value="year">‡∏õ‡∏µ</option>
        <option value="month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
      </select>
    </div>
    <button onclick="calcRetire()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</button>
    <button onclick="showTable()" style="margin-top:10px;background:#059669;">‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
    <div class="result" id="result"></div>
    <div class="small">* ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏î‡∏¢‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏ñ‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠<br>
      <b>‡∏™‡∏π‡∏ï‡∏£ Present Value of Growing Annuity</b>
    </div>
    <div class="table-area" id="table-area" style="display:none"></div>
  </div>
  <script>
    function formatNumberInput(el, allowDecimal = true) {
      // Remove all except numbers and decimal (if allowed)
      let v = el.value.replace(/,/g, "");
      if (!allowDecimal) v = v.replace(/\D/g, '');
      else v = v.replace(/[^0-9.]/g, '');

      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏≠‡∏±‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å
      const parts = v.split(".");
      if (parts.length > 2) v = parts[0] + '.' + parts[1];

      // Comma ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°
      let withComma = v;
      if (withComma) {
        let [intPart, decPart] = withComma.split(".");
        intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        withComma = decPart ? intPart + "." + decPart : intPart;
      }
      el.value = withComma;
    }

    function getInputNumber(id) {
      const val = document.getElementById(id).value.replace(/,/g, "");
      return Number(val);
    }

    function futureValue(present, rate, years) {
      return present * Math.pow(1 + rate, years);
    }

    function calcRetire(showTableOnly = false) {
      const expense = getInputNumber('expense');
      const expenseType = document.getElementById('expenseType').value;
      const untilRetire = getInputNumber('untilRetire');
      const inflation = getInputNumber('inflation') / 100;
      const returnRate = getInputNumber('returnRate') / 100;
      const afterRetire = getInputNumber('afterRetire');
      const afterType = document.getElementById('afterType').value;

      if (!expense || !untilRetire || !afterRetire) return;

      const annualExpense = expenseType === 'month' ? expense * 12 : expense;
      const firstYearExpense = futureValue(annualExpense, inflation, untilRetire);

      const n = afterType === 'month' ? afterRetire / 12 : afterRetire;
      const r = returnRate;
      const g = inflation;

      let PV;
      if (Math.abs(r-g) < 1e-8) {
        PV = firstYearExpense * n / (1 + r);
      } else {
        PV = firstYearExpense / (r - g) * (1 - Math.pow((1+g)/(1+r), n));
      }

      if (!showTableOnly) {
        document.getElementById('result').innerHTML = `
          <b>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì:</b><br>
          <span style="font-size:2em;color:#059669;">${PV.toLocaleString(undefined, {maximumFractionDigits: 0})} ‡∏ö‡∏≤‡∏ó</span>
          <div class="small">(‡∏õ‡∏µ‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ${firstYearExpense.toLocaleString(undefined, {maximumFractionDigits: 0})} ‡∏ö‡∏≤‡∏ó)</div>
        `;
      }
      return { PV, firstYearExpense, n, r, g };
    }

    function showTable() {
      const { PV, firstYearExpense, n, r, g } = calcRetire(true) || {};
      if (!PV) return;
      let tableHTML = `
        <span class="close-btn" onclick="document.getElementById('table-area').style.display='none'">&times;</span>
        <b>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</b>
        <table>
          <thead>
            <tr>
              <th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà</th>
              <th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢<br>(‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)</th>
              <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏•‡∏≤‡∏¢‡∏õ‡∏µ<br>(‡∏ö‡∏≤‡∏ó)</th>
            </tr>
          </thead>
          <tbody>
      `;
      let remain = PV;
      for(let i=1; i<=Math.floor(n); i++) {
        let withdraw = firstYearExpense * Math.pow(1+g, i-1);
        remain = remain * (1+r) - withdraw;
        tableHTML += `
          <tr>
            <td>${i}</td>
            <td>${withdraw.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
            <td>${remain > 0 ? remain.toLocaleString(undefined, {maximumFractionDigits: 0}) : "0"}</td>
          </tr>
        `;
        if (remain < 0) break; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
      }
      tableHTML += `</tbody></table>`;
      document.getElementById('table-area').innerHTML = tableHTML;
      document.getElementById('table-area').style.display = "block";
    }
  </script>
</body>
</html>
